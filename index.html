<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <!-- 
    ========================================================================
    2026 é¦¬å¹´ç‰¹ä»•ç‰ˆ - é«˜ç©©å®šåº¦é•·è¼©å‹å–„ç‰ˆ & é›™æ¨¡å¼è¦–è¦ºå¼•æ“
    
    æŠ€è¡“å †ç–Šï¼šHTML5 + React 18 + TailwindCSS + åŸç”Ÿ Canvas API (ç‰©ç†é‹ç®—)
    è¨­è¨ˆèªå½™ï¼šiOS Human Interface Guidelines (å¤§è§¸æ§å€ã€é«˜å°æ¯”ã€ç„¡æ²å‹•)
    ========================================================================
  -->
  <title>2026 é‡‘é¦¬è¿æ˜¥ï¼å¤§è€äºŒè¨˜åˆ†æ‰€</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* =====================================================================
       æ ¸å¿ƒè¨­è¨ˆç³»çµ± (Design System)
       å®šç¾©å…¨åŸŸçš„ CSS è®Šæ•¸ï¼Œæ–¹ä¾¿æ—¥å¾ŒæŠ½æ›ä¸»é¡Œã€‚
    ===================================================================== */
    :root {
      /* å®‰å…¨å€è€ƒé‡ï¼Œç¢ºä¿ä¸è¢«ç€æµ·æˆ–åº•éƒ¨ç™½æ¢é®æ“‹ */
      --safe-top: env(safe-area-inset-top, 44px);
      --safe-bottom: env(safe-area-inset-bottom, 34px);
      
      /* ç¯€æ…¶æ¨¡å¼è‰²å½©ï¼šæ·±é‚ƒé†‡åšçš„ç´…åº•èˆ‡è€€çœ¼é‡‘ */
      --color-festive-bg-deep: #140000;
      --color-festive-bg-mid: #3a0000;
      --color-festive-gold: #fbbf24;
      --color-festive-glass: rgba(40, 5, 5, 0.65);
      
      /* ç°¡æ½”æ¨¡å¼è‰²å½©ï¼šæ¥µè‡´é»‘èˆ‡å…§æ–‚çš„ç°è‰²èª¿ï¼Œé™ä½è¦–è¦ºè² æ“” */
      --color-minimal-bg: #0a0a0a;
      --color-minimal-glass: rgba(25, 25, 25, 0.85);
      --color-minimal-accent: #e5e5e5;
    }

    /* ç’°å¢ƒé‡ç½®ï¼š
       æœ€é—œéµçš„æ˜¯ touch-action: none èˆ‡ overflow: hiddenã€‚
       é€™å…©è€…è¯æ‰‹å¾¹åº•æ®ºæ­» iOS Safari ä¸Šä»»ä½•é æœŸå¤–çš„æ»‘å‹•ã€ä¸‹æ‹‰æ›´æ–°ã€å›å½ˆæ•ˆæœã€‚
       æˆ‘å€‘è¦åœ¨é€™å€‹ç•«å¸ƒå…§ï¼Œç”¨ Flexbox å»ºç«‹è‡ªå·±çš„ç§©åºã€‚
    */
    body {
      margin: 0;
      padding: 0;
      background-color: var(--color-festive-bg-deep); /* é è¨­åº•è‰²ï¼Œé¿å…è¼‰å…¥é–ƒçˆ */
      color: #ffffff;
      overflow: hidden; 
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "PingFang TC", "Helvetica Neue", sans-serif;
      -webkit-tap-highlight-color: transparent;
      user-select: none;
      touch-action: none;
    }

    #root {
      width: 100vw;
      /* ä½¿ç”¨ 100dvh (Dynamic Viewport Height)ï¼Œå‹•æ…‹é©æ‡‰ç¶²å€åˆ—çš„æ”¶åˆ */
      height: 100dvh; 
      position: relative;
    }

    /* --- Canvas ç¹ªåœ–å±¤ï¼Œç½®æ–¼æœ€åº•ç«¯ --- */
    #fx-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none; /* è®“ä½¿ç”¨è€…çš„è§¸æ§ç›´æ¥ç©¿é€åˆ°ä¸‹æ–¹çš„ React å…ƒä»¶ */
    }

    /* --- UI å…ƒä»¶æ¨£å¼ --- */
    /* é«˜å°æ¯”æ¯›ç»ç’ƒï¼šé•·è¼©ç‰ˆç‰¹åˆ¥åŠ æ·±äº†èƒŒæ™¯çš„é€æ˜åº¦ï¼Œ
       æ¨æ£„éåº¦é€šé€çš„è¨­è¨ˆï¼Œç¢ºä¿ä¸Šæ–¹æ•¸å­—èˆ‡æ–‡å­—çš„æ¸…æ™°åº¦ã€‚
    */
    .ui-card-festive {
      background: var(--color-festive-glass);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border-radius: 24px;
    }

    .ui-card-minimal {
      background: var(--color-minimal-glass);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 24px;
    }

    .ui-nav-bar {
      background: rgba(10, 0, 0, 0.85);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* æ•¸å­—å­—é«”å„ªåŒ–ï¼Œç¢ºä¿å¯¬åº¦ä¸€è‡´ï¼Œé¿å…æ•¸å­—è·³å‹• */
    .num-display { 
      font-variant-numeric: tabular-nums; 
      letter-spacing: -0.02em;
    }
    
    /* å…§éƒ¨æ²è»¸éš±è—ï¼Œåƒ…åœ¨æ­·å²ç´€éŒ„å€é–‹æ”¾å‚ç›´æ»¾å‹• */
    .history-scroll { 
      scrollbar-width: none; 
      overflow-y: auto; 
      overflow-x: hidden; 
      overscroll-behavior: contain; /* é˜»æ­¢æ»¾å‹•éˆçµï¼Œé¿å…æ‹–å‹•åˆ°åº•å±¤ */
    }
    .history-scroll::-webkit-scrollbar { display: none; }

    /* æŒ‰éˆ•çš„ç‰©ç†å›é¥‹æ„Ÿ */
    .btn-press:active {
      transform: scale(0.94);
      transition: transform 0.05s ease-out;
    }

    /* æµå…‰æ–‡å­—å‹•ç•« */
    @keyframes gold-shine {
      0% { background-position: -200% center; }
      100% { background-position: 200% center; }
    }
    .text-gold-shine {
      background: linear-gradient(
        100deg, 
        #b45309 20%, 
        #fef08a 45%, 
        #ffffff 50%, 
        #fef08a 55%, 
        #b45309 80%
      );
      background-size: 200% auto;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      animation: gold-shine 6s linear infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo, useCallback } = React;

    /* =====================================================================
       [ç³»çµ±åº•å±¤] ç‹€æ…‹æŒä¹…åŒ– Hook
       ç”¨ä¾†è™•ç† localStorage è®€å¯«ï¼Œé¿å…æ±¡æŸ“ä¸»å…ƒä»¶çš„é‚è¼¯ä¹¾æ·¨åº¦ã€‚
    ===================================================================== */
    function useStickyState(defaultValue, key) {
      const [value, setValue] = useState(() => {
        const stickyValue = window.localStorage.getItem(key);
        return stickyValue !== null ? JSON.parse(stickyValue) : defaultValue;
      });
      useEffect(() => {
        window.localStorage.setItem(key, JSON.stringify(value));
      }, [key, value]);
      return [value, setValue];
    }

    /* =====================================================================
       [è¦–è¦ºå¼•æ“] HTML5 Canvas é«˜æ•ˆèƒ½æ¸²æŸ“å™¨
       é€™æ¬¡çš„é‡é»æ˜¯ã€Œå„ªé›…ã€èˆ‡ã€Œç‰©ç†çœŸå¯¦æ„Ÿã€ã€‚
       æˆ‘å€‘ä¸ä¾è³´ä»»ä½•å¤–éƒ¨åœ–æª”ï¼Œæ‰€æœ‰ç‡ˆç± ã€æµè˜‡ã€é‡‘é¦¬éƒ½æ˜¯ç”±æ•¸å­¸èˆ‡å¹¾ä½•ç¹ªè£½ã€‚
    ===================================================================== */
    
    // åŸºç¤ç‰©ç†å‘é‡
    class Vector2 {
      constructor(x = 0, y = 0) { this.x = x; this.y = y; }
      add(v) { this.x += v.x; this.y += v.y; return this; }
      sub(v) { this.x -= v.x; this.y -= v.y; return this; }
      mult(n) { this.x *= n; this.y *= n; return this; }
      mag() { return Math.sqrt(this.x * this.x + this.y * this.y); }
      normalize() { const m = this.mag(); if (m !== 0) this.mult(1 / m); return this; }
    }

    // ç’°å¢ƒå¸¸æ•¸
    const PHYSICS = {
      gravity: 0.8,
      windPhase: 0,
      windSpeed: 0.01,
      getWind: () => Math.sin(PHYSICS.windPhase) * 0.05 + (Math.random() * 0.02 - 0.01)
    };

    // --- å¯¦é«”ï¼šå–®æ“ºç‡ˆç±  (Pendulum Lantern) ---
    // æ¨¡æ“¬çœŸå¯¦ç‡ˆç± æ›åœ¨é ‚éƒ¨çš„æ–æ›³æ„Ÿ
    class Lantern {
      constructor(originX, originY, length, size, isLeft) {
        this.origin = new Vector2(originX, originY); // æ‡¸æ›é»
        this.length = length; // ç¹©é•·
        this.size = size; // ç‡ˆç± å¤§å°æ¯”ä¾‹
        
        // å–®æ“ºç‰©ç†å±¬æ€§
        this.angle = isLeft ? 0.1 : -0.1; // åˆå§‹è§’åº¦
        this.aVelocity = 0; // è§’é€Ÿåº¦
        this.aAcceleration = 0; // è§’åŠ é€Ÿåº¦
        this.damping = 0.995; // é˜»å°¼(ç©ºæ°£é˜»åŠ›)ï¼Œè®“å®ƒä¸æœƒç„¡æ­¢ç›¡è¶Šæ™ƒè¶Šå¤§
        
        // æµè˜‡ç³»çµ± (Tassels) - åˆ©ç”¨ç°¡æ˜“çš„ Verlet ç©åˆ†æ¨¡æ“¬å¤šæ®µæŸ”æ€§ç¹©ç´¢
        this.tassels = [];
        const numSegments = 5;
        for (let i = 0; i < numSegments; i++) {
          this.tassels.push({
            pos: new Vector2(0, 0),
            oldPos: new Vector2(0, 0)
          });
        }
        this.tasselLen = this.size * 0.6;
      }

      update() {
        // 1. è¨ˆç®—å–®æ“ºé‹å‹•
        // å…¬å¼ï¼šè§’åŠ é€Ÿåº¦ = (-é‡åŠ› / ç¹©é•·) * sin(è§’åº¦) + é¢¨åŠ›å½±éŸ¿
        const wind = PHYSICS.getWind() * 0.02;
        this.aAcceleration = (-PHYSICS.gravity * 0.05 / this.length) * Math.sin(this.angle) + wind;
        this.aVelocity += this.aAcceleration;
        this.aVelocity *= this.damping;
        this.angle += this.aVelocity;

        // è¨ˆç®—ç‡ˆç± æœ¬é«”ç›®å‰çš„çµ•å°åº§æ¨™
        this.lanternX = this.origin.x + this.length * Math.sin(this.angle);
        this.lanternY = this.origin.y + this.length * Math.cos(this.angle);

        // 2. æ›´æ–°ä¸‹æ–¹æµè˜‡çš„ç‰©ç† (Verlet Integration)
        const tasselBaseX = this.lanternX + Math.sin(this.angle) * this.size;
        const tasselBaseY = this.lanternY + Math.cos(this.angle) * this.size;
        
        this.tassels[0].pos.x = tasselBaseX;
        this.tassels[0].pos.y = tasselBaseY;

        for (let i = 1; i < this.tassels.length; i++) {
          const t = this.tassels[i];
          // æ–½åŠ é‡åŠ›èˆ‡é¢¨åŠ›
          const vx = (t.pos.x - t.oldPos.x) * 0.95 + wind * 5;
          const vy = (t.pos.y - t.oldPos.y) * 0.95 + PHYSICS.gravity;
          
          t.oldPos.x = t.pos.x;
          t.oldPos.y = t.pos.y;
          
          t.pos.x += vx;
          t.pos.y += vy;

          // ç´„æŸç¹©ç´¢é•·åº¦ (Constraint)
          const dx = t.pos.x - this.tassels[i-1].pos.x;
          const dy = t.pos.y - this.tassels[i-1].pos.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          const diff = this.tasselLen - dist;
          const percent = diff / dist / 2;
          const offsetX = dx * percent;
          const offsetY = dy * percent;

          t.pos.x += offsetX;
          t.pos.y += offsetY;
        }
      }

      draw(ctx) {
        // ç•«æ‡¸æ›çš„ç¹©å­
        ctx.beginPath();
        ctx.moveTo(this.origin.x, this.origin.y);
        ctx.lineTo(this.lanternX, this.lanternY);
        ctx.strokeStyle = 'rgba(251, 191, 36, 0.6)'; // æš—é‡‘è‰²
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.save();
        ctx.translate(this.lanternX, this.lanternY);
        ctx.rotate(this.angle);

        // ç¹ªè£½ç‡ˆç± å…‰æšˆ
        const glow = ctx.createRadialGradient(0, 0, this.size * 0.2, 0, 0, this.size * 2);
        glow.addColorStop(0, 'rgba(220, 38, 38, 0.4)');
        glow.addColorStop(1, 'rgba(220, 38, 38, 0)');
        ctx.fillStyle = glow;
        ctx.beginPath();
        ctx.arc(0, 0, this.size * 2, 0, Math.PI * 2);
        ctx.fill();

        // ç¹ªè£½ç‡ˆç± æœ¬é«” (ç´…åº•æ©¢åœ“)
        ctx.fillStyle = '#dc2626';
        ctx.beginPath();
        ctx.ellipse(0, 0, this.size * 0.85, this.size, 0, 0, Math.PI * 2);
        ctx.fill();

        // ç‡ˆç± ä¸Šçš„é‡‘ç·šéª¨æ¶
        ctx.strokeStyle = '#b91c1c';
        ctx.lineWidth = 1.5;
        for(let i = 0.2; i <= 0.8; i+=0.3) {
           ctx.beginPath();
           ctx.ellipse(0, 0, this.size * i, this.size, 0, 0, Math.PI * 2);
           ctx.stroke();
        }

        // ä¸Šä¸‹é‡‘è‰²è£é£¾è“‹
        ctx.fillStyle = '#f59e0b';
        ctx.fillRect(-this.size * 0.3, -this.size * 1.1, this.size * 0.6, this.size * 0.15);
        ctx.fillRect(-this.size * 0.25, this.size * 0.95, this.size * 0.5, this.size * 0.15);

        ctx.restore();

        // ç•«æµè˜‡ (ä¸ç”¨ rotateï¼Œå› ç‚ºç‰©ç†å·²è¨ˆç®—çµ•å°åº§æ¨™)
        ctx.beginPath();
        ctx.moveTo(this.tassels[0].pos.x, this.tassels[0].pos.y);
        for (let i = 1; i < this.tassels.length; i++) {
          ctx.lineTo(this.tassels[i].pos.x, this.tassels[i].pos.y);
        }
        ctx.strokeStyle = '#ea580c'; // æ©™ç´…è‰²
        ctx.lineWidth = 3;
        ctx.stroke();
      }
    }

    // --- å¯¦é«”ï¼šèƒŒæ™¯é‡‘é¦¬å‰ªå½± (Golden Horse Silhouette) ---
    // åˆ©ç”¨è²èŒ²æ›²ç·šå‹•æ…‹ç•«å‡ºå„ªé›…çš„é¦¬
    class HorseEmblem {
      constructor(width, height) {
        this.x = width * 0.5;
        this.y = height * 0.4;
        this.scale = width < 400 ? 1.2 : 1.8; // æ ¹æ“šè¢å¹•å¯¬åº¦ç¸®æ”¾
        this.pulsePhase = 0;
      }
      
      update() {
        this.pulsePhase += 0.015;
      }

      draw(ctx, isMinimal) {
        // å¦‚æœæ˜¯ç°¡æ½”æ¨¡å¼ï¼Œä¸ç•«é¦¬ï¼Œä¿æŒç•«é¢ä¹¾æ·¨
        if (isMinimal) return;

        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.scale(this.scale, this.scale);
        
        // å‘¼å¸é€æ˜åº¦
        const alpha = Math.sin(this.pulsePhase) * 0.03 + 0.06; 
        ctx.globalAlpha = alpha;
        
        // é€™è£¡æˆ‘å€‘ä¸è¼‰å…¥åœ–æª”ï¼Œç›´æ¥åˆ»å‡ºé¦¬çš„æŠ½è±¡å¹¾ä½•ç·šæ¢ï¼Œå±•ç¾ Canvas çš„å¨åŠ›
        ctx.strokeStyle = '#fde68a'; 
        ctx.lineWidth = 1.5;
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';

        ctx.beginPath();
        // é¦¬é ­èˆ‡è„–å­
        ctx.moveTo(10, -35);
        ctx.quadraticCurveTo(25, -20, 15, 0);
        ctx.quadraticCurveTo(5, 20, -10, 25);
        // é¦¬èƒŒ
        ctx.quadraticCurveTo(-30, 30, -45, 20);
        ctx.quadraticCurveTo(-55, 10, -60, -5);
        // å¾Œè…¿
        ctx.quadraticCurveTo(-60, 25, -70, 45);
        ctx.lineTo(-65, 45);
        ctx.quadraticCurveTo(-50, 15, -40, 25);
        // è…¹éƒ¨èˆ‡å‰è…¿
        ctx.quadraticCurveTo(-20, 35, 0, 30);
        ctx.quadraticCurveTo(15, 50, 25, 45);
        ctx.lineTo(20, 40);
        ctx.quadraticCurveTo(10, 25, 15, 10);
        // è‡‰éƒ¨ç´°ç¯€
        ctx.quadraticCurveTo(35, -5, 40, -20);
        ctx.quadraticCurveTo(30, -30, 20, -30);
        ctx.lineTo(10, -35);
        
        // é¬ƒæ¯›é»ç¶´
        ctx.moveTo(15, 0); ctx.lineTo(0, -15);
        ctx.moveTo(5, 15); ctx.lineTo(-10, 0);
        
        ctx.stroke();
        ctx.restore();
      }
    }

    // --- å¯¦é«”ï¼šç’°å¢ƒæ˜Ÿå¡µç²’å­ ---
    class StarDust {
      constructor(w, h) {
        this.x = Math.random() * w;
        this.y = Math.random() * h;
        this.size = Math.random() * 1.5 + 0.5;
        this.speedY = Math.random() * -0.5 - 0.1;
        this.speedX = Math.random() * 0.4 - 0.2;
        this.life = Math.random() * Math.PI * 2;
        this.w = w;
        this.h = h;
      }
      update() {
        this.x += this.speedX + PHYSICS.getWind() * 2;
        this.y += this.speedY;
        this.life += 0.02;
        if (this.y < -10) this.y = this.h + 10;
        if (this.x < -10) this.x = this.w + 10;
        if (this.x > this.w + 10) this.x = -10;
      }
      draw(ctx, isMinimal) {
        if (isMinimal) return;
        const alpha = (Math.sin(this.life) * 0.5 + 0.5) * 0.4;
        ctx.fillStyle = `rgba(253, 230, 138, ${alpha})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // --- è² è²¬çµ±ç±Œèˆ‡ç®¡ç†çš„ Canvas å¼•æ“çµ„ä»¶ ---
    const CanvasEngine = ({ theme }) => {
      const canvasRef = useRef(null);
      const isMinimal = theme === 'minimal';

      useEffect(() => {
        const canvas = canvasRef.current;
        if (!canvas) return;
        const ctx = canvas.getContext('2d', { alpha: false }); // é—œé–‰ Alpha ä»¥å„ªåŒ–æ•ˆèƒ½
        
        let animationId;
        let width, height;
        
        // å ´æ™¯ç‰©ä»¶
        let leftLantern, rightLantern, horse;
        let dusts = [];

        const initScene = () => {
          width = window.innerWidth;
          height = window.innerHeight;
          const dpr = window.devicePixelRatio || 1;
          canvas.width = width * dpr;
          canvas.height = height * dpr;
          ctx.scale(dpr, dpr);

          // æ ¹æ“šè¢å¹•å¯¬åº¦æ±ºå®šç‡ˆç± å¤§å°
          const lanternSize = width < 400 ? 25 : 35;
          const ropeLen = height * 0.15;
          
          leftLantern = new Lantern(width * 0.15, -10, ropeLen, lanternSize, true);
          rightLantern = new Lantern(width * 0.85, -10, ropeLen * 1.2, lanternSize * 0.9, false);
          horse = new HorseEmblem(width, height);
          
          dusts = [];
          for(let i=0; i<40; i++) dusts.push(new StarDust(width, height));
        };

        initScene();
        window.addEventListener('resize', initScene);

        const renderLoop = () => {
          PHYSICS.windPhase += 0.01;

          // 1. ç¹ªè£½èƒŒæ™¯ (ä¾æ“šä¸»é¡Œ)
          if (isMinimal) {
            ctx.fillStyle = '#0a0a0a'; // æ¥µè‡´é»‘
            ctx.fillRect(0, 0, width, height);
          } else {
            // ç¯€æ…¶æ·±åº¦ç´…æ¼¸å±¤
            const grad = ctx.createRadialGradient(width/2, height*0.3, 0, width/2, height/2, height);
            grad.addColorStop(0, '#3a0000');
            grad.addColorStop(1, '#0c0000');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, width, height);
          }

          // 2. æ›´æ–°èˆ‡ç¹ªè£½å¯¦é«”
          if (!isMinimal) {
            leftLantern.update(); leftLantern.draw(ctx);
            rightLantern.update(); rightLantern.draw(ctx);
          }
          
          horse.update(); horse.draw(ctx, isMinimal);

          dusts.forEach(d => {
            d.update();
            d.draw(ctx, isMinimal);
          });

          animationId = requestAnimationFrame(renderLoop);
        };

        renderLoop();

        return () => {
          window.removeEventListener('resize', initScene);
          cancelAnimationFrame(animationId);
        };
      }, [theme]); // ç•¶ä¸»é¡Œåˆ‡æ›æ™‚é‡æ–°ç¶å®šå¼•æ“è¨­å®š

      return <canvas id="fx-canvas" ref={canvasRef} />;
    };

    /* =====================================================================
       [UI ç³»çµ±] çŸ¢é‡åœ–ç¤ºåº«
       æ‰€æœ‰ Icon å …æŒä½¿ç”¨ SVG ç¢ºä¿ Retina è¢å¹•ä¸æ¨¡ç³Šã€‚
    ===================================================================== */
    const Icon = ({ name, className = "w-6 h-6", strokeWidth = "2" }) => {
      const svgs = {
        trophy: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
        play: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>,
        history: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>,
        minus: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>,
        plus: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
        info: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>,
        palette: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r=".5" fill="currentColor"/><circle cx="17.5" cy="10.5" r=".5" fill="currentColor"/><circle cx="8.5" cy="7.5" r=".5" fill="currentColor"/><circle cx="6.5" cy="12.5" r=".5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.836-.437-1.124-.298-.336-.498-.76-.498-1.226 0-.962.775-1.742 1.734-1.742H16c3.31 0 6-2.69 6-6 0-5.5-4.5-10-10-10z"/></svg>,
        crown: <svg className={className} viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M2.2 19.5h19.6v2H2.2v-2zm1.4-2.8l2.8-10.2L12 13.8l5.6-7.3 2.8 10.2H3.6z"/></svg>,
        close: <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      };
      return svgs[name] || null;
    };

    /* =====================================================================
       [UI å…ƒä»¶] ç©å®¶è¨ˆåˆ†æ“ä½œå¡ç‰‡ (Player Control Card)
       é‡å°é•·è¼©å„ªåŒ–ï¼šå£“ç¸®ç„¡ç”¨ç•™ç™½ï¼Œæ”¾å¤§äº’å‹•ç†±å€ï¼ŒæŒ‰éˆ•å¯¬åº¦æ¥µå¤§åŒ–ã€‚
    ===================================================================== */
    const PlayerCard = ({ player, cards, twoCount, theme, onUpdateCards, onToggleTwo }) => {
      const isWinner = cards === 0;
      const isMinimal = theme === 'minimal';
      
      // ä¾æ“šä¸»é¡Œçµ¦äºˆä¸åŒçš„å¡ç‰‡åº•è‰²èˆ‡æ¡†ç·š
      const cardClass = isMinimal ? 'ui-card-minimal' : 'ui-card-festive';
      // ç•¶è„«æ‰‹æ™‚ï¼Œæ•´å¼µå¡ç‰‡èª¿æš—é€€å±…å¹•å¾Œ
      const stateClass = isWinner ? 'opacity-50 grayscale-[50%]' : '';
      
      // è€äºŒç‹€æ…‹çš„è¦–è¦ºå‘ˆç¾ï¼šå±éšªè¨Šè™Ÿç”¨ç´…/æ©˜è‰²é«˜äº®
      let badgeStyle = "bg-white/10 text-white/50 border border-white/10";
      let badgeText = "å¹³éœç„¡æ³¢";
      if (isWinner) {
        badgeStyle = "bg-emerald-500/20 text-emerald-300 border border-emerald-500/30";
        badgeText = "ğŸ‰ é †åˆ©è„«æ‰‹";
      } else if (twoCount > 0) {
        badgeStyle = "bg-rose-500/20 text-rose-300 border border-rose-500/50 shadow-[0_0_10px_rgba(244,63,94,0.3)]";
        badgeText = `ğŸ’£ æ‰£ç•™è€äºŒ Ã— ${twoCount}`;
      }

      return (
        <div className={`${cardClass} ${stateClass} p-3 flex flex-col justify-center transition-all duration-300 h-full`}>
          <div className="flex items-center justify-between h-full px-1">
            
            {/* å·¦åŠéƒ¨ï¼šèº«åˆ†èˆ‡ç‹€æ…‹ */}
            <div className="flex flex-col items-start gap-1.5 w-[35%]">
              <span className={`text-[24px] font-black tracking-widest leading-none ${isMinimal ? 'text-white' : 'text-[#fef08a]'}`}>
                {player.name}
              </span>
              <button 
                onClick={onToggleTwo}
                disabled={isWinner}
                className={`px-2.5 py-1 rounded-md text-[13px] font-bold whitespace-nowrap transition-colors btn-press ${badgeStyle}`}
              >
                {badgeText}
              </button>
            </div>

            {/* å³åŠéƒ¨ï¼šå·¨ç„¡éœ¸æ­¥é€²å™¨ (Stepper) */}
            <div className="flex items-center gap-1.5 w-[60%] justify-end">
              <button 
                onClick={() => onUpdateCards(-1)} 
                className={`w-[52px] h-[52px] rounded-2xl flex items-center justify-center btn-press transition-colors
                  ${isMinimal ? 'bg-white/10 text-white active:bg-white/20' : 'bg-[#7f1d1d]/80 text-[#fca5a5] border border-[#991b1b] active:bg-[#991b1b]'}
                `}
                aria-label="æ¸›å°‘ä¸€å¼µç‰Œ"
              >
                <Icon name="minus" className="w-7 h-7" strokeWidth="3" />
              </button>
              
              <div className={`w-[54px] text-center text-[38px] font-black num-display leading-none 
                ${cards >= 8 && !isWinner ? 'text-rose-400' : 'text-white'}
              `}>
                {cards}
              </div>
              
              <button 
                onClick={() => onUpdateCards(1)} 
                className={`w-[52px] h-[52px] rounded-2xl flex items-center justify-center btn-press transition-colors
                  ${isMinimal ? 'bg-white/10 text-white active:bg-white/20' : 'bg-[#7f1d1d]/80 text-[#fca5a5] border border-[#991b1b] active:bg-[#991b1b]'}
                `}
                aria-label="å¢åŠ ä¸€å¼µç‰Œ"
              >
                <Icon name="plus" className="w-7 h-7" strokeWidth="3" />
              </button>
            </div>

          </div>
        </div>
      );
    };

    /* =====================================================================
       [ä¸»é«”æ‡‰ç”¨] App å…ƒä»¶
       è² è²¬é‚è¼¯èª¿åº¦èˆ‡ä½ˆå±€æ§åˆ¶ã€‚
       çµ•å°ç¦æ­¢æ›´å‹•è¨ˆåˆ†æ ¸å¿ƒé‚è¼¯ï¼Œç¢ºä¿å‡ç´š UI çš„åŒæ™‚ä¸æœƒå¼„å£ç®—éŒ¢åŠŸèƒ½ã€‚
    ===================================================================== */
    const App = () => {
      // åˆå§‹åŒ–å›ºå®šç©å®¶è³‡æ–™
      const INITIAL_PLAYERS = useMemo(() => [
        { id: 'p1', name: 'çˆ¸çˆ¸', score: 0 },
        { id: 'p2', name: 'åª½åª½', score: 0 },
        { id: 'p3', name: 'å“¥å“¥', score: 0 },
        { id: 'p4', name: 'å¦¹å¦¹', score: 0 },
      ], []);

      // æ ¸å¿ƒç‹€æ…‹ç®¡ç† (é€é localStorage æŒä¹…åŒ–)
      const [players, setPlayers] = useStickyState(INITIAL_PLAYERS, 'b2_players_v3');
      const [history, setHistory] = useStickyState([], 'b2_history_v3');
      const [theme, setTheme] = useStickyState('festive', 'b2_theme_v3'); // 'festive' | 'minimal'
      
      // ç•¶å‰å±€æ•¸çš„æš«å­˜ç‹€æ…‹
      const [activeTab, setActiveTab] = useState('play'); // 'play', 'scores', 'history'
      const [currentCards, setCurrentCards] = useState({ p1: 0, p2: 0, p3: 0, p4: 0 });
      const [twoCounts, setTwoCounts] = useState({ p1: 0, p2: 0, p3: 0, p4: 0 });
      const [winnerTwoCount, setWinnerTwoCount] = useState(0);
      
      // UI ç–ŠåŠ å±¤æ§åˆ¶
      const [showRules, setShowRules] = useState(false);

      // --- é‚è¼¯æ“ä½œï¼šæ›´æ–°æ‰‹ç‰Œ ---
      const handleCardChange = useCallback((id, delta) => {
        setCurrentCards(prev => {
          const newVal = Math.max(0, Math.min(13, prev[id] + delta));
          // å¦‚æœç‰Œæ•¸æ­¸é›¶ï¼ˆè„«æ‰‹ï¼‰ï¼Œå¼·åˆ¶æ¸…ç©ºä»–æ‰‹ä¸Šçš„è€äºŒç´€éŒ„
          if (newVal === 0) {
            setTwoCounts(p => ({ ...p, [id]: 0 }));
          }
          return { ...prev, [id]: newVal };
        });
      }, []);

      // --- é‚è¼¯æ“ä½œï¼šåˆ‡æ›æ‰£ç•™è€äºŒæ•¸é‡ ---
      const handleTwoToggle = useCallback((id) => {
        if (currentCards[id] === 0) return; // æ²’ç‰Œçš„äººä¸èƒ½æ‰£è€äºŒ
        setTwoCounts(prev => ({ ...prev, [id]: (prev[id] + 1) % 5 })); // 0 -> 1 -> 2 -> 3 -> 4 -> 0
      }, [currentCards]);

      // --- é‚è¼¯æ“ä½œï¼šæ ¸å¿ƒçµç®—å¼•æ“ (å®Œå…¨éµå¾ªåŸæœ‰å•†æ¥­é‚è¼¯) ---
      const handleCalculate = useCallback(() => {
        const pIds = ['p1', 'p2', 'p3', 'p4'];
        const winners = pIds.filter(id => currentCards[id] === 0);
        
        if (winners.length !== 1) {
          // è‡ªè£½è¼•é‡æç¤ºå–ä»£ç³»çµ± alertï¼Œä¿æŒ UI ä¸€è‡´æ€§
          const msg = document.createElement('div');
          msg.textContent = "è«‹ç¢ºèªå‰›å¥½æœ‰ä¸€äººè„«æ‰‹ï¼ˆå‰© 0 å¼µï¼‰";
          msg.className = "fixed top-20 left-1/2 -translate-x-1/2 bg-rose-600 text-white px-6 py-3 rounded-full shadow-2xl z-[999] font-bold tracking-wider animate-in fade-in slide-in-from-top-4";
          document.body.appendChild(msg);
          setTimeout(() => {
            msg.classList.add('animate-out', 'fade-out', 'slide-out-to-top-4');
            setTimeout(() => msg.remove(), 300);
          }, 2000);
          return;
        }

        const winnerId = winners[0];
        let totalPot = 0;
        const roundScores = {};

        // èµ°è¨ªæ‰€æœ‰ç©å®¶ï¼Œè¨ˆç®—è¼¸å®¶æ‰£åˆ†
        pIds.forEach(id => {
          if (id === winnerId) {
            roundScores[id] = 0; // è´å®¶æš«æ™‚ç‚º 0ï¼Œç¨å¾ŒåŠ ç¸½
          } else {
            let p = currentCards[id]; // åŸºæœ¬å¼µæ•¸
            if (p >= 8) p *= 2; // æ»¿8å¼µä»¥ä¸Šç›´æ¥é›™å€
            if (twoCounts[id] > 0) p *= Math.pow(2, twoCounts[id]); // æ‰‹æ‰£è€äºŒç¿»å€
            if (winnerTwoCount > 0) p *= Math.pow(2, winnerTwoCount); // è´å®¶å¤§æ‹›å…¨å ´ç¿»å€
            
            roundScores[id] = -p; // è¨˜ç‚ºè² åˆ†
            totalPot += p; // ç´¯åŠ è‡³å½©æ± 
          }
        });

        // è´å®¶æ‹¿èµ°æ‰€æœ‰å½©æ± 
        roundScores[winnerId] = totalPot;
        
        // æ›´æ–°ç¸½åˆ†ç‹€æ…‹
        setPlayers(prev => prev.map(p => ({ 
          ...p, 
          score: p.score + roundScores[p.id] 
        })));
        
        // å¯«å…¥å°æˆ°æ˜ç´°
        setHistory(prev => [{
          id: Date.now(),
          time: new Date().toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' }),
          scores: roundScores,
          isExtreme: winnerTwoCount > 0
        }, ...prev]);

        // æ¡Œé¢æ¸…ç†èˆ‡ç•«é¢åˆ‡æ›
        setCurrentCards({ p1: 0, p2: 0, p3: 0, p4: 0 });
        setTwoCounts({ p1: 0, p2: 0, p3: 0, p4: 0 });
        setWinnerTwoCount(0);
        setActiveTab('scores');
      }, [currentCards, twoCounts, winnerTwoCount]);

      // --- é‚è¼¯æ“ä½œï¼šé‡æ–°æ´—ç‰Œ ---
      const handleResetAll = useCallback(() => {
        if(window.confirm("ç¢ºå®šè¦æŠŠæ‰€æœ‰äººçš„åˆ†æ•¸æ­¸é›¶ï¼Ÿ\néå¾€çš„æˆ°å ±æ˜ç´°ä¹Ÿæœƒä¸€ä½µæ¸…ç©ºå–”ï¼")) {
          setPlayers(INITIAL_PLAYERS);
          setHistory([]);
          setActiveTab('play');
        }
      }, [INITIAL_PLAYERS]);

      // --- ç•«é¢æ¸²æŸ“ ---
      const isMinimal = theme === 'minimal';

      return (
        <>
          {/* æ¸²æŸ“åº•å±¤ Canvas (è² è²¬æ‰€æœ‰å‹•ç•«èˆ‡åº•è‰²) */}
          <CanvasEngine theme={theme} />

          {/* UI å®¹å™¨ï¼šé€™æ˜¯ä¸€å€‹é«˜åº¦æ­£å¥½ç­‰æ–¼è¢å¹•å¯è¦–ç¯„åœ (100dvh) çš„çµ•å°å®¹å™¨ã€‚
            æˆ‘å€‘ç”¨ flex-col å°‡å®ƒåˆ†ç‚ºä¸‰å€‹éƒ¨åˆ†ï¼šHeader(å›ºå®š), Main(å½ˆæ€§), Footer(å›ºå®š)ã€‚
            pointer-events-none ç¢ºä¿æœªè¢«å…ƒä»¶ä½”æ“šçš„åœ°æ–¹å¯ä»¥è®“é»æ“Šç©¿é€ï¼ˆé›–ç„¶é€™è£¡æ²’æœ‰éœ€æ±‚ï¼Œä½†å¥½ç¿’æ…£ï¼‰ã€‚
          */}
          <div className="absolute inset-0 z-10 flex flex-col mx-auto max-w-md pointer-events-none">
            
            {/* 1. é ‚éƒ¨æ¨™é¡Œå€å¡Š (Header) */}
            <header className="pt-[calc(var(--safe-top)+12px)] pb-3 px-5 flex justify-between items-center shrink-0 pointer-events-auto">
              <div className="flex flex-col gap-0.5">
                <span className={`text-[12px] font-bold tracking-[0.2em] uppercase ${isMinimal ? 'text-white/40' : 'text-amber-500/80'}`}>
                  Year of the Horse
                </span>
                <h1 className={`text-[30px] font-black tracking-tight leading-none ${isMinimal ? 'text-white' : 'text-gold-shine drop-shadow-lg'}`}>
                  å¤§è€äºŒè¨˜åˆ†æ‰€
                </h1>
              </div>
              
              <div className="flex items-center gap-2">
                {/* ä¸»é¡Œåˆ‡æ›æŒ‰éˆ• */}
                <button 
                  onClick={() => setTheme(prev => prev === 'festive' ? 'minimal' : 'festive')}
                  className={`w-9 h-9 rounded-full flex items-center justify-center btn-press backdrop-blur-md border transition-all duration-500
                    ${isMinimal ? 'bg-white/10 border-white/20 text-white' : 'bg-amber-900/50 border-amber-500/30 text-amber-400'}
                  `}
                  aria-label="åˆ‡æ›è¦–è¦ºä¸»é¡Œ"
                >
                  <Icon name="palette" className="w-5 h-5" strokeWidth="2.5" />
                </button>
                {/* èªªæ˜æŒ‰éˆ• */}
                <button 
                  onClick={() => setShowRules(true)} 
                  className={`w-9 h-9 rounded-full flex items-center justify-center btn-press backdrop-blur-md border transition-all
                    ${isMinimal ? 'bg-white/10 border-white/20 text-white' : 'bg-red-900/50 border-red-500/30 text-white'}
                  `}
                  aria-label="æŸ¥çœ‹è¦å‰‡"
                >
                  <Icon name="info" className="w-5 h-5" strokeWidth="2.5" />
                </button>
              </div>
            </header>

            {/* 2. ä¸»è¦å…§å®¹å€å¡Š (Main) - ä½¿ç”¨ flex-1 åƒæ»¿å‰©é¤˜ç©ºé–“ï¼Œmin-h-0 å…è¨±å…§éƒ¨å£“ç¸®é¿å…ç ´ç‰ˆ */}
            <main className="flex-1 relative flex flex-col px-4 pb-[calc(76px+var(--safe-bottom))] min-h-0 pointer-events-auto">
              
              {/* === åˆ†é  Aï¼šæ“ä½œå€ (Play) === */}
              {activeTab === 'play' && (
                <div className="flex-1 flex flex-col justify-between animate-in fade-in duration-300 h-full">
                  
                  {/* ç©å®¶å¡ç‰‡å€ï¼šåˆ©ç”¨ flex-1 èˆ‡ justify-evenly åœ¨å‚ç›´æ–¹å‘å®Œç¾å‡åˆ†ï¼Œå…æ²å‹•ï¼ */}
                  <div className="flex-1 flex flex-col justify-evenly gap-2 min-h-0 py-1">
                    {INITIAL_PLAYERS.map(pBase => (
                      <div key={pBase.id} className="flex-1 min-h-[70px] max-h-[95px]">
                        <PlayerCard 
                          player={players.find(x => x.id === pBase.id)}
                          cards={currentCards[pBase.id]}
                          twoCount={twoCounts[pBase.id]}
                          theme={theme}
                          onUpdateCards={(delta) => handleCardChange(pBase.id, delta)}
                          onToggleTwo={() => handleTwoToggle(pBase.id)}
                        />
                      </div>
                    ))}
                  </div>

                  {/* çµç®—è¡Œå‹•å€ï¼šå›ºå®šæ–¼ Play åˆ†é åº•éƒ¨ */}
                  <div className="shrink-0 pt-3 flex flex-col gap-2">
                    <button 
                      onClick={() => setWinnerTwoCount(v => (v + 1) % 5)}
                      className={`
                        w-full py-2.5 rounded-xl text-[14px] font-bold transition-all duration-300 btn-press border flex justify-center items-center gap-2
                        ${winnerTwoCount > 0 
                          ? 'bg-rose-600 text-white border-rose-400 shadow-[0_0_15px_rgba(225,29,72,0.4)]' 
                          : isMinimal ? 'bg-white/5 border-white/10 text-white/50' : 'bg-black/30 border-white/10 text-white/70 backdrop-blur-sm'
                        }
                      `}
                    >
                      {winnerTwoCount > 0 ? (
                        <>ğŸ”¥ è´å®¶è€äºŒçµå°¾ Ã— {winnerTwoCount} <span className="bg-black/40 px-2 py-0.5 rounded text-[11px]">å…¨å ´åŠ å€</span></>
                      ) : (
                        <span>è´å®¶ä¸€èˆ¬ç‰Œå‹è„«æ‰‹</span>
                      )}
                    </button>
                    
                    <button 
                      onClick={handleCalculate}
                      className={`
                        w-full h-[58px] rounded-2xl text-[22px] font-black tracking-[0.15em] btn-press transition-all
                        ${isMinimal 
                          ? 'bg-white text-black hover:bg-gray-200' 
                          : 'bg-gradient-to-b from-amber-400 to-amber-600 text-[#3a0000] border-b-4 border-amber-700 shadow-[0_8px_20px_rgba(245,158,11,0.3)]'}
                      `}
                    >
                      çµç®—æ”¶éŒ¢
                    </button>
                  </div>
                </div>
              )}

              {/* === åˆ†é  Bï¼šæˆ°ç¸¾æ’è¡Œ (Scores) === */}
              {activeTab === 'scores' && (
                <div className="flex-1 flex flex-col justify-center gap-6 animate-in slide-in-from-bottom-8 duration-300">
                  <div className={`overflow-hidden flex flex-col w-full ${isMinimal ? 'ui-card-minimal' : 'ui-card-festive'}`}>
                    <div className="px-5 py-3 bg-black/30 border-b border-white/10 flex justify-between items-center">
                      <h2 className={`text-[16px] font-bold tracking-widest ${isMinimal ? 'text-white' : 'text-amber-400'}`}>å¤§å±€æˆ°å ±</h2>
                      <span className="text-[12px] text-white/40">å³æ™‚ç´¯ç©</span>
                    </div>
                    <div className="flex flex-col">
                      {[...players].sort((a, b) => b.score - a.score).map((p, idx) => {
                        const isLeader = idx === 0 && p.score > 0;
                        const sColor = p.score > 0 ? 'text-emerald-400' : p.score < 0 ? 'text-rose-400' : 'text-white/40';
                        return (
                          <div key={p.id} className={`relative px-6 py-4 flex items-center justify-between border-b border-white/5 last:border-0 ${isLeader ? 'bg-amber-500/10' : ''}`}>
                            <div className="flex items-center gap-4">
                              <div className="w-8 flex justify-center">
                                {isLeader ? <Icon name="crown" className={`w-8 h-8 ${isMinimal ? 'text-white' : 'text-amber-400 drop-shadow-md'}`} /> : <span className="text-[20px] font-bold text-white/30">{idx + 1}</span>}
                              </div>
                              <span className="text-[22px] font-bold tracking-wide text-white">{p.name}</span>
                            </div>
                            <span className={`text-[32px] font-black num-display ${sColor}`}>
                              {p.score > 0 ? `+${p.score}` : p.score}
                            </span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                  
                  <button 
                    onClick={handleResetAll} 
                    className={`w-full h-[54px] rounded-2xl text-[16px] font-bold tracking-widest btn-press border
                      ${isMinimal ? 'bg-white/5 border-white/10 text-white/60 hover:bg-white/10' : 'bg-black/40 border-amber-900/50 text-amber-500 backdrop-blur-md'}
                    `}
                  >
                    åˆ†æ•¸æ­¸é›¶ï¼é‡å•Ÿæ–°å±€
                  </button>
                </div>
              )}

              {/* === åˆ†é  Cï¼šæ˜ç´°æ¸…å–® (History) === */}
              {activeTab === 'history' && (
                <div className="flex-1 history-scroll pt-2 space-y-3 pb-6 animate-in slide-in-from-bottom-8 duration-300">
                  {history.length === 0 ? (
                    <div className="h-full flex flex-col items-center justify-center text-white/30">
                      <Icon name="history" className="w-14 h-14 mb-3" strokeWidth="1" />
                      <p className="text-[16px] tracking-widest font-medium">ç‰Œæ¡Œå‰›é–‹ï¼Œå°šç„¡æˆ°æœ</p>
                    </div>
                  ) : (
                    history.map((rec) => (
                      <div key={rec.id} className={`p-4 ${isMinimal ? 'ui-card-minimal' : 'ui-card-festive'} opacity-90 hover:opacity-100 transition-opacity`}>
                        <div className="flex justify-between items-center mb-3 pb-2 border-b border-white/10">
                          <span className="text-[14px] font-medium text-white/60">{rec.time}</span>
                          {rec.isExtreme && (
                            <span className="text-[11px] font-bold bg-rose-600 text-white px-2 py-0.5 rounded shadow-sm">
                              è€äºŒå¤§æ‹›
                            </span>
                          )}
                        </div>
                        <div className="grid grid-cols-4 gap-2 text-center">
                          {INITIAL_PLAYERS.map(p => {
                            const s = rec.scores[p.id];
                            return (
                              <div key={p.id} className="bg-black/20 py-2 rounded-lg">
                                <div className="text-[12px] text-white/50 mb-0.5">{p.name}</div>
                                <div className={`text-[16px] font-black num-display ${s > 0 ? 'text-emerald-400' : s < 0 ? 'text-rose-400' : 'text-white/30'}`}>
                                  {s > 0 ? `+${s}` : s}
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      </div>
                    ))
                  )}
                </div>
              )}
            </main>

            {/* 3. åº•éƒ¨å°èˆªå€å¡Š (Bottom Nav) - æ¡ç”¨çµ•å°å®šä½è²¼åº• */}
            <nav className="absolute bottom-0 w-full ui-nav-bar pb-[var(--safe-bottom)] pt-2 z-20 shrink-0 pointer-events-auto">
              <div className="flex justify-evenly items-center max-w-sm mx-auto">
                <button onClick={() => setActiveTab('scores')} className="relative flex flex-col items-center gap-1 w-20 py-2 btn-press">
                  <Icon name="trophy" className={`w-6 h-6 transition-colors ${activeTab === 'scores' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`} strokeWidth={activeTab === 'scores' ? "2.5" : "2"} />
                  <span className={`text-[11px] font-bold tracking-wider transition-colors ${activeTab === 'scores' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`}>æˆ°å ±</span>
                </button>
                <button onClick={() => setActiveTab('play')} className="relative flex flex-col items-center gap-1 w-20 py-2 btn-press">
                  <Icon name="play" className={`w-6 h-6 transition-colors ${activeTab === 'play' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`} strokeWidth={activeTab === 'play' ? "2.5" : "2"} />
                  <span className={`text-[11px] font-bold tracking-wider transition-colors ${activeTab === 'play' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`}>è¨˜åˆ†</span>
                </button>
                <button onClick={() => setActiveTab('history')} className="relative flex flex-col items-center gap-1 w-20 py-2 btn-press">
                  <Icon name="history" className={`w-6 h-6 transition-colors ${activeTab === 'history' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`} strokeWidth={activeTab === 'history' ? "2.5" : "2"} />
                  <span className={`text-[11px] font-bold tracking-wider transition-colors ${activeTab === 'history' ? (isMinimal?'text-white':'text-amber-400') : 'text-white/30'}`}>æ˜ç´°</span>
                </button>
              </div>
            </nav>
          </div>

          {/* 4. æµ®å‹•é¢æ¿ï¼šéŠæˆ²è¦å‰‡ (Bottom Sheet) */}
          {showRules && (
            <div className="absolute inset-0 z-[100] flex flex-col justify-end pointer-events-auto">
              <div 
                className="absolute inset-0 bg-black/70 backdrop-blur-sm animate-in fade-in duration-300" 
                onClick={() => setShowRules(false)}
              ></div>
              
              <div className={`relative w-full rounded-t-[32px] p-6 pb-[calc(24px+var(--safe-bottom))] shadow-[0_-10px_40px_rgba(0,0,0,0.5)] animate-in slide-in-from-bottom-full duration-300
                ${isMinimal ? 'bg-[#121212] border-t border-white/10' : 'bg-[#220505] border-t border-red-900/50'}
              `}>
                <div className="w-12 h-1.5 bg-white/20 rounded-full mx-auto mb-6"></div>
                
                <div className="flex justify-between items-center mb-5">
                  <h3 className={`text-[24px] font-black tracking-widest ${isMinimal ? 'text-white' : 'text-amber-400'}`}>æ±Ÿæ¹–è¦çŸ©</h3>
                  <button onClick={() => setShowRules(false)} className="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center btn-press">
                    <Icon name="close" className="w-5 h-5 text-white/70" />
                  </button>
                </div>

                <div className="space-y-5 text-[16px] leading-relaxed text-white/80">
                  <div className="flex gap-3 items-start">
                    <div className="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center shrink-0 text-white font-bold text-[13px] mt-0.5">1</div>
                    <p><strong className="text-white block mb-0.5">åŸºæœ¬ç›¤é¢</strong>å‰© 1~7 å¼µç‰Œï¼Œ1å¼µæ‰£1å€ã€‚è‹¥å‰© <span className={`font-bold ${isMinimal?'text-white':'text-amber-400'}`}>8 å¼µä»¥ä¸Š</span>ï¼Œç›´æ¥ç¿»å€æ‰£é™¤ã€‚</p>
                  </div>
                  
                  <div className="flex gap-3 items-start">
                    <div className="w-6 h-6 rounded-full bg-white/10 flex items-center justify-center shrink-0 text-white font-bold text-[13px] mt-0.5">2</div>
                    <p><strong className="text-white block mb-0.5">æ‰‹æ¡è€äºŒ</strong>è¼¸å®¶è‹¥è¢«æŸ¥ç²æ‰‹æ¡è€äºŒï¼Œæ¯ 1 å¼µç¸½é¡ä¹˜ 2 å€ï¼ˆ2å¼µä¹˜4å€ï¼Œä»¥æ­¤é¡æ¨ï¼‰ã€‚</p>
                  </div>

                  <div className={`flex gap-3 items-start p-4 rounded-xl mt-2 ${isMinimal ? 'bg-white/5 border border-white/10' : 'bg-red-950/60 border border-red-900/50'}`}>
                    <div className={`w-6 h-6 rounded-full flex items-center justify-center shrink-0 font-bold text-[13px] mt-0.5 ${isMinimal ? 'bg-white/20 text-white' : 'bg-red-500/20 text-red-400'}`}>ğŸ”¥</div>
                    <div>
                      <strong className={`block mb-0.5 ${isMinimal ? 'text-white' : 'text-red-400'}`}>å¤§æ‹›ï¼šè€äºŒçµå°¾</strong>
                      <p className="text-[14px]">è´å®¶æ‰“å‡ºè€äºŒè„«æ‰‹ï¼Œå…¨å ´è¼¸å®¶ <span className={`font-bold ${isMinimal ? 'text-white' : 'text-red-400'}`}>å¼·åˆ¶å…¨é¡ç¿»å€</span>ã€‚å¯ç–ŠåŠ è¨ˆç®—ã€‚</p>
                    </div>
                  </div>
                </div>

                <button 
                  onClick={() => setShowRules(false)} 
                  className="w-full mt-6 h-[56px] bg-white/10 hover:bg-white/20 rounded-xl text-[18px] font-bold text-white btn-press transition-colors"
                >
                  å¥½ï¼Œæˆ‘çŸ¥é“äº†
                </button>
              </div>
            </div>
          )}
        </>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
